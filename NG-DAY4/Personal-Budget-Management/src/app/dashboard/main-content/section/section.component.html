<section class="section">
    <div class="top-section">
        <div class="income-div" id="income-div-id">
            <i class="fa-solid fa-circle-down"></i>
            <label id="ttl-inc">Total Income:</label>
            <label id="total-income-dsp">{{loggedUserDashData.income}}</label>
        </div>
        <div class="expense-div" id="expense-div-id">
            <i class="fa-solid fa-circle-up"></i>
            <label id="ttl-exp">Total Expense:</label>
            <label id="total-expense-dsp">{{loggedUserDashData.expense}}</label>
        </div>
        <div class="balance-div" id="balance-div-id">
            <i class="fa-solid fa-hand-holding-dollar"></i>
            <label id="ttl-bln">Total Balance:</label>
            <label id="total-balance-dsp">
                {{loggedUserDashData.income - loggedUserDashData.expense}}
            </label>
        </div>
    </div>
    <div class="mid-section">
        <div class="mid-section-one">
            <button id="new-goal-btn" (click)="openNewGoalPopup(overlay, newGoalPopup)">
                <div><i class="fa-solid fa-bullseye fa-2xl"></i></div>
                <label>+ Saving Goal</label>
            </button>
            <button id="new-transaction-btn" (click)="openNewTransactPopup(overlay, newTransactPopup)">
                <div><i class="fa-solid fa-money-bill-transfer fa-2xl"></i></div>
                <label>+ Transaction</label>
            </button>
            <button id="dummy-btn"></button>
        </div>
    </div>
    <div class="overlay" id="overlay" #overlay></div>
    <div class="goal-form-div" id="new-goal-popup" #newGoalPopup>
        <h2>New Goal</h2>
        <button class="close-popup" id="close-goal-popup" (click)="closeNewGoalPopup(newGoalForm, overlay, newGoalPopup)">&times;</button>
        <form action="" id="new-goal-form"
            (ngSubmit)="addNewGoal(
                newGoalForm, overlay, newGoalPopup
                )"
            #newGoalForm="ngForm"
            >
            <label>Set goal name</label>
            <input
                placeholder="Goal name"
                type="text"
                id="new-goal-name-inp"
                name="goalName"
                maxlength="10"
                ngModel
                required
            />
            <label>Set goal target</label>
            <input
                placeholder="Goal target"
                type="number"
                id="new-goal-trgt-inp"
                name="goalTrgt"
                pattern="[0-9]+"
                ngModel
                required
                min="0"
            />
            <label>Add initial contribution (not mandatory)</label>
            <input
                placeholder="Initial contribution"
                type="number"
                id="new-goal-init-inp"
                ngModel
                name="initFund"
                pattern="[0-9]+"
                min="0"
                />
            <input id="save-goal-btn" type="submit" value="Save Goal"
                [disabled]="(newGoalForm.invalid || (newGoalForm.form.get('initFund')?.touched &&
                ((loggedUserDashData.income - loggedUserDashData.expense < newGoalForm.form.get('initFund')?.value)) ||
                (newGoalForm.form.get('initFund')?.value > newGoalForm.form.get('goalTrgt')?.value)) || (checkDuplicateGoals(newGoalForm)))"
            >
            <p class="popup-errors" id="new-goal-error">
                @if (
                    newGoalForm.form.get('goalName')?.touched &&
                    newGoalForm.form.get('goalName')?.errors?.['required']
                ) {
                    Goal name can't be empty!
                } @else if (
                    newGoalForm.form.get('goalName')?.dirty &&
                    (checkDuplicateGoals(newGoalForm))
                ) {
                    Duplicate names not allowed!
                } @else if (
                    newGoalForm.form.get('goalTrgt')?.touched &&
                    newGoalForm.form.get('goalTrgt')?.errors?.['required']
                ) {
                    Goal target cant be empty!
                } @else if (
                    newGoalForm.form.get('goalTrgt')?.touched &&
                    newGoalForm.form.get('goalTrgt')?.errors?.['pattern'] ||
                    newGoalForm.form.get('goalTrgt')?.errors?.['min']
                ) {
                    Goal target can only be a +ve number!
                } @else if (
                    newGoalForm.form.get('initFund')?.touched && (newGoalForm.form.get('initFund')?.value >
                    (loggedUserDashData.income - loggedUserDashData.expense)) || (newGoalForm.form.get('initFund')?.value > newGoalForm.form.get('goalTrgt')?.value)
                ) {
                    contribution can't exceed balance | target!
                } @else if (
                    newGoalForm.form.get('initFund')?.touched &&
                    newGoalForm.form.get('initFund')?.errors?.['pattern'] ||
                    newGoalForm.form.get('initFund')?.errors?.['min']
                ) {
                    contribution can only be a +ve number!
                } @else {
                    {{errorOut}}
                }
            </p>
        </form>
    </div>
    <div class="transaction-form-div" id="new-transaction-popup" #newTransactPopup>
        <h2>New Transaction</h2>
        <button class="close-popup" id="close-transaction-popup"
        (click)="closeTransactGoalPopup(newTransactForm, overlay, newTransactPopup)"
        >
            &times;
        </button>
        <form action="" id="new-transaction-form" #newTransactForm="ngForm"
            (submit)="addNewTransaction(newTransactForm, overlay, newTransactPopup)"
        >
            <label>Select transaction type</label>
            <select id="new-transaction-type-select"
                (change)="loadAptCategories(newTransactForm)"
                name="transactTypeSel"
                required
                ngModel
            >
                <option
                    style="font-weight: 600; font-size: 17px"
                    value="expense"
                >
                    Expense
                </option>
                <option
                    style="font-weight: 600; font-size: 17px"
                    value="income"
                >
                    Income
                </option>
            </select>
            <label>Enter transaction amount</label>
            <input
                placeholder="Transaction amount"
                type="text"
                id="new-transaction-amt-inp"
                name="transactAmt"
                ngModel
                required
                pattern="[0-9]+"
                min="1"
            />
            <label>Select transaction date</label>
            <input type="date" id="new-transaction-date-inp" name="transactDate" ngModel required/>
            <label>Select transaction source/purpose</label>
            <select id="new-transaction-purpose-select" name="transactCateg" ngModel required>
                @for (option of arrOfOptions; track option) {
                    <option
                        style="font-weight: 600; font-size: 17px"
                        value="{{option}}"
                    >
                        {{option}}
                    </option>
                }
            </select>
            <input id="save-transaction-btn" value="Save Transaction" type="submit"
                [disabled]="newTransactForm.invalid"
            >
            <span class="popup-errors" id="new-transact-error">
                @if (
                    newTransactForm.form.get("transactTypeSel")?.touched &&
                    (newTransactForm.form.get("transactTypeSel")?.value == "" ||
                    newTransactForm.form.get("transactTypeSel")?.value == null)
                ) {
                    Transaction type can't be empty!
                } @else if (
                    newTransactForm.form.get("transactAmt")?.touched &&
                    newTransactForm.form.get("transactAmt")?.errors?.['required']
                ) {
                    Transaction amount can't be empty!
                } @else if (
                    newTransactForm.form.get("transactAmt")?.touched &&
                    (newTransactForm.form.get("transactAmt")?.errors?.['pattern'] ||
                    newTransactForm.form.get("transactAmt")?.errors?.['min'])
                ) {
                    Transaction can only be a +ve number!
                } @else if (
                    newTransactForm.form.get("transactAmt")?.touched &&
                    (newTransactForm.form.get("transactTypeSel")?.value == "expense" &&
                    (newTransactForm.form.get("transactAmt")?.value > (loggedUserDashData.income - loggedUserDashData.expense)))
                ) {
                    Expense can't exceed balance!
                } @else if (
                    newTransactForm.form.get("transactDate")?.touched &&
                    newTransactForm.form.get("transactDate")?.errors?.['required']
                ) {
                    A valid date must be selected!
                } @else if (
                    newTransactForm.form.get("transactCateg")?.touched &&
                    (newTransactForm.form.get("transactTypeSel")?.value == "" ||
                    newTransactForm.form.get("transactTypeSel")?.value == null)
                ) {
                    Transaction category can't be empty!
                } @else {
                    {{errorOut}}
                }
            </span>
        </form>
    </div>
</section>
